---
import type { MateriauResponse } from '../utils/pocketbase-types';

interface Props {
  materiauxMonture: MateriauResponse[];   // Couleurs pour monture
  materiauxVerres: MateriauResponse[];    // Couleurs pour verres
  materiauxBranches: MateriauResponse[];  // Couleurs pour branches
}

const { materiauxMonture, materiauxVerres, materiauxBranches } = Astro.props;
---

<div class="personnalisation-tabs">
  <!-- Les 3 boutons d'onglets -->
  <div role="tablist" class="flex gap-4 mb-8">
    <button 
      role="tab" 
      data-tab="monture" 
      class="tab-btn flex-1 bg-accent text-white py-4 rounded-lg font-display text-xl"
    >
      Monture →
    </button>
    <button 
      role="tab" 
      data-tab="verres" 
      class="tab-btn flex-1 bg-secondary text-white py-4 rounded-lg font-display text-xl"
    >
      Verres
    </button>
    <button 
      role="tab" 
      data-tab="branches" 
      class="tab-btn flex-1 bg-secondary text-white py-4 rounded-lg font-display text-xl"
    >
      Branches
    </button>
  </div>

  <!-- Contenu dynamique selon l'onglet actif -->
  <div class="tab-content bg-base-200 p-8 rounded-lg">
    <!-- Onglet Monture -->
    <div id="monture" class="tab-panel">
      <h3 class="text-2xl font-display mb-4">Quel style vous correspond ?</h3>
      <div class="grid grid-cols-7 gap-4">
        {materiauxMonture.map((materiau) => (
          <button 
            class="color-btn w-12 h-12 rounded-full border-2 border-neutral hover:scale-110 transition-transform"
            style={`background-color: ${materiau.code_valeur}`}
            data-materiau-id={materiau.id}
            data-partie="monture"
            aria-label={materiau.libelle}
          />
        ))}
      </div>
    </div>

    <!-- Onglet Verres -->
    <div id="verres" class="tab-panel hidden">
      <h3 class="text-2xl font-display mb-4">Verres "classiques"</h3>
      <p class="text-sm mb-4">Des verres simples, facilement nettoyables...</p>
      
      <h4 class="text-xl font-display mt-6 mb-2">Verres anti-lumière bleue</h4>
      <p class="text-sm mb-4">Des verres traités avec filtre...</p>
      
      <h4 class="text-xl font-display mt-6 mb-2">Verres Teintés</h4>
      <p class="text-sm mb-4">Pour voir la vie de toutes les couleurs !</p>
      
      <div class="flex gap-4 mt-4">
        {materiauxVerres.map((materiau) => (
          <button 
            class="color-btn w-16 h-16 rounded-lg border-2"
            style={`background-color: ${materiau.code_valeur}`}
            data-materiau-id={materiau.id}
            data-partie="verres"
            aria-label={materiau.libelle}
          />
        ))}
      </div>
    </div>

    <!-- Onglet Branches -->
    <div id="branches" class="tab-panel hidden">
      <h3 class="text-2xl font-display mb-4">Ajoutez une touche personnelle !</h3>
      <div class="grid grid-cols-7 gap-4">
        {materiauxBranches.map((materiau) => (
          <button 
            class="color-btn w-12 h-12 rounded-full border-2 border-neutral hover:scale-110 transition-transform"
            style={`background-color: ${materiau.code_valeur}`}
            data-materiau-id={materiau.id}
            data-partie="branches"
            aria-label={materiau.libelle}
          />
        ))}
      </div>
    </div>
  </div>
</div>

<script>
  // Gestion des onglets
  const tabButtons = document.querySelectorAll<HTMLButtonElement>('.tab-btn');
  const tabPanels = document.querySelectorAll('.tab-panel');

  tabButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      const targetTab = btn.dataset.tab;
      
      // Reset all tabs
      tabButtons.forEach(b => b.classList.remove('bg-accent'));
      tabButtons.forEach(b => b.classList.add('bg-secondary'));
      tabPanels.forEach(p => p.classList.add('hidden'));
      
      // Active selected tab
      btn.classList.remove('bg-secondary');
      btn.classList.add('bg-accent');
      document.getElementById(targetTab!)?.classList.remove('hidden');
    });
  });

  // Gestion de la sélection de couleur
  const colorButtons = document.querySelectorAll<HTMLButtonElement>('.color-btn');
  
  colorButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      const materiauId = btn.dataset.materiauId;
      const partie = btn.dataset.partie;
      
      // Modifier le SVG en temps réel (on fera ça après)
      console.log(`Sélectionné: ${partie} avec matériau ${materiauId}`);
      
      // Reset selection visuelle
      document.querySelectorAll(`[data-partie="${partie}"]`).forEach(b => {
        b.classList.remove('ring-4', 'ring-accent');
      });
      
      // Highlight selected
      btn.classList.add('ring-4', 'ring-accent');
    });
  });
</script>
